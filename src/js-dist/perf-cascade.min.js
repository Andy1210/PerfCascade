/*PerfCascade build:22/12/2015 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d={newTextNode:function(a){return document.createTextNode(a)},newTag:function(a,b,c){b=b||{};var e=document.createElement(a);for(var f in b)"text"!=f&&(e[f]=b[f]);return b.text?e.textContent=b.text:b.childElement&&("object"==typeof b.childElement?b.childElement instanceof NodeList?Array.prototype.slice.call(b.childElement,0).forEach(function(a){e.appendChild(a)}):e.appendChild(b.childElement):e.appendChild(d.newTextNode(b.childElement))),b["class"]&&(e.className=b["class"]),e.style.cssText=c||"",e},tableFactory:function(a,b,c){void 0===a&&(a="");var e=d.newTag("div",{id:a,"class":"table-holder"}),f=d.newTag("table"),g=d.newTag("thead");return g.appendChild(b(d.newTag("tr"))),f.appendChild(g),f.appendChild(c(d.newTag("tbody"))),e.appendChild(f),e},combineNodes:function(a,b){var c=document.createElement("div");return"object"==typeof a?c.appendChild(a):"string"==typeof a&&c.appendChild(d.newTextNode(a)),"object"==typeof b?c.appendChild(b):"string"==typeof b&&c.appendChild(d.newTextNode(b)),c.childNodes},addClass:function(a,b){return a.classList?a.classList.add(b):a.setAttribute("class",a.getAttribute("class")+" "+b),a},removeClass:function(a,b){return a.classList?a.classList.remove(b):a.setAttribute("class",a.getAttribute("class").replace(new RegExp("(\\s|^)"+b+"(\\s|$)","g"),"$2")),a},removeAllChildren:function(a){for(;a.childNodes.length>0;)a.removeChild(a.childNodes[0])}};Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d},{}],2:[function(a,b,c){var d={newEl:function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);b=b||{};for(var e in b)"text"!=e&&d.setAttributeNS(null,e,b[e]);return d.textContent=b.text||"",d.style.cssText=c||"",d},newTextEl:function(a,b,c){return void 0===c&&(c=""),d.newEl("text",{fill:"#111",y:b.toString(),text:a},c+" text-shadow:0 0 4px #fff;")},getNodeTextWidth:function(a){var b=d.newEl("svg:svg",{},"visibility:hidden;");b.appendChild(a),window.document.body.appendChild(b);var c=a.getBBox().width;return b.parentNode.removeChild(b),c}};Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d},{}],3:[function(a,b,c){function d(a,b){var c,e=h["default"].newEl("rect",{width:a.width/a.unit+"%",height:a.height-1,x:Math.round(a.x/a.unit*100)/100+"%",y:a.y,"class":(b&&b.length>0?"time-block":"segment")+" "+(a.cssClass||"block-other")});return a.label&&e.appendChild(h["default"].newEl("title",{text:a.label})),e.addEventListener("mouseenter",a.onRectMouseEnter),e.addEventListener("mouseleave",a.onRectMouseLeave),b&&b.length>0?(c=h["default"].newEl("g"),c.appendChild(e),b.forEach(function(b){if(b.total>0&&"number"==typeof b.start){var e={width:b.total,height:8,x:b.start||.001,y:a.y,cssClass:b.cssClass,label:b.name+" ("+Math.round(b.start)+"ms - "+Math.round(b.end)+"ms | total: "+Math.round(b.total)+"ms)",unit:a.unit,onRectMouseEnter:a.onRectMouseEnter,onRectMouseLeave:a.onRectMouseLeave};c.appendChild(d(e))}}),c):e}function e(a,b){for(var c=h["default"].newEl("g",{"class":"time-scale full-width"}),d=0,e=a/1e3,f=100/e;e>=d;d++){var g=h["default"].newTextEl(d+"sec",b);d>e-.2?(g.setAttribute("x",f*d-.5+"%"),g.setAttribute("text-anchor","end")):g.setAttribute("x",f*d+.5+"%");var i=h["default"].newEl("line",{x1:f*d+"%",y1:"0",x2:f*d+"%",y2:b});c.appendChild(i),c.appendChild(g)}return c}function f(a,b,c){var d=h["default"].newEl("rect",{width:(a.total||1)/b+"%",height:c,x:(a.start||.001)/b+"%",y:0,"class":a.cssClass||"block-other"});return d.appendChild(h["default"].newEl("title",{text:a.name})),d}function g(a,b,c){var d=h["default"].newEl("g",{transform:"scale(1, 1)","class":"marker-holder"});return a.forEach(function(e,f){var g=e.startTime/b,j=h["default"].newEl("g",{"class":"mark-holder"}),k=h["default"].newEl("g",{"class":"line-holder"}),l=h["default"].newEl("g",{"class":"line-lable-holder",x:g+"%"});e.x=g;var m=h["default"].newTextEl(e.name,c+25);m.setAttribute("x",g+"%"),m.setAttribute("stroke",""),k.appendChild(h["default"].newEl("line",{x1:g+"%",y1:0,x2:g+"%",y2:c})),a[f-1]&&e.x-a[f-1].x<1&&(m.setAttribute("x",a[f-1].x+1+"%"),e.x=a[f-1].x+1),k.appendChild(h["default"].newEl("line",{x1:g+"%",y1:c,x2:e.x+"%",y2:c+23}));var n=!1,o=function(a){n||(n=!0,i["default"].addClass(k,"active"),j.parentNode.appendChild(j))},p=function(a){n=!1,i["default"].removeClass(k,"active")};m.addEventListener("mouseenter",o),m.addEventListener("mouseleave",p),l.appendChild(m),j.appendChild(h["default"].newEl("title",{text:e.name+" ("+Math.round(e.startTime)+"ms)"})),j.appendChild(k),d.appendChild(j),j.appendChild(l)}),d}var h=a("../helpers/svg"),i=a("../helpers/dom");c.createRect=d,c.createTimeWrapper=e,c.createBgRect=f,c.renderMarks=g},{"../helpers/dom":1,"../helpers/svg":2}],4:[function(a,b,c){function d(a){alert(a)}function e(a){var b=a.target.files;if(!b)return void d("Failed to load HAR file");var c=new FileReader;c.onload=function(a){var b;try{b=JSON.parse(a.target.result)}catch(a){return void d("File does not seem to be a valid HAR file")}f(b.log)},c.readAsText(b[0])}function f(a){var b=i["default"].transfrom(a);h["default"].removeAllChildren(j),j.appendChild(g.setupTimeLine(b))}var g=a("./waterfall"),h=a("./helpers/dom"),i=a("./transformers/har"),j=document.getElementById("output");document.getElementById("fileinput").addEventListener("change",e,!1),window.fetch("test-data/www.bbc.com.har").then(function(a){return a.json().then(function(a){return f(a.log)})})},{"./helpers/dom":1,"./transformers/har":5,"./waterfall":7}],5:[function(a,b,c){var d=a("../typing/time-block"),e=function(){function a(){}return a.makeBlockCssClass=function(a){var b=function(a){var b=a.split("/");switch(b[0]){case"image":return"image";case"font":return"font"}switch(b[1]){case"svg+xml":case"html":return"html";case"css":return"css";case"vnd.ms-fontobject":case"font-woff":case"font-woff2":case"x-font-truetype":case"x-font-opentype":case"x-font-woff":return"font";case"javascript":case"x-javascript":case"script":case"json":return"javascript";case"x-shockwave-flash":return"flash"}return"other"};return"block-"+b(a)},a.transfrom=function(a){var b=this;console.log("HAR created by %s(%s) of %s page(s)",a.creator.name,a.creator.version,a.pages.length),window.data=a;var c=0,e=a.entries.filter(function(b){return b.pageref===a.pages[0].id}).map(function(e){var f=a.pages.filter(function(a){return a.id===e.pageref})[0],g=new Date(f.startedDateTime),h=new Date(e.startedDateTime),i=h.getTime()-g.getTime();c<i+e.time&&(c=i+e.time);e.timings;return new d["default"](e.request.url,i,i+e.time,b.makeBlockCssClass(e.response.content.mimeType),b.buildSectionBlocks(i,e.timings),e)});return console.table(e.map(function(a){return{name:a.name,start:a.start,end:a.end,TEMP:a.cssClass,total:a.total}})),console.log(e),{durationMs:c,blocks:e,marks:[],lines:[]}},a.buildSectionBlocks=function(a,b){return["blocked","dns","connect","send","wait","receive","ssl"].reduce(function(c,e){if(b[e]&&-1!==b[e]){var f=c.length>0?c[c.length-1].end:a;return c.concat([new d["default"](e,f,f+b[e],"block-"+e)])}return c},[])},a}();Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=e},{"../typing/time-block":6}],6:[function(a,b,c){var d=function(){function a(a,b,c,d,e,f){void 0===d&&(d=""),void 0===e&&(e=[]),this.name=a,this.start=b,this.end=c,this.cssClass=d,this.segments=e,this.rawResource=f,this.total="number"!=typeof b||"number"!=typeof c?void 0:c-b}return a}();Object.defineProperty(c,"__esModule",{value:!0}),c["default"]=d},{}],7:[function(a,b,c){function d(a){var b=a.durationMs/100,c=a.blocks.filter(function(a){return"number"==typeof a.start&&"number"==typeof a.total}).sort(function(a,b){return(a.start||0)-(b.start||0)}),d=a.marks.length>0?a.marks.reduce(function(a,b){return Math.max(a,e["default"].getNodeTextWidth(e["default"].newTextEl(b.name,0)))},0):0,h=25*(c.length+1),i=h+d+35,j=e["default"].newEl("svg:svg",{height:Math.floor(i),"class":"water-fall-chart"}),k=e["default"].newEl("g",{"class":"labels"}),l=e["default"].newEl("line",{x1:"0",y1:"0",x2:"0",y2:h,"class":"line-end"}),m=e["default"].newEl("line",{x1:"0",y1:"0",x2:"0",y2:h,"class":"line-start"}),n=function(a){var b=a.target;f["default"].addClass(b,"active");var c=b.x.baseVal.valueInSpecifiedUnits+b.width.baseVal.valueInSpecifiedUnits+"%",d=b.x.baseVal.valueInSpecifiedUnits+"%";l.x1.baseVal.valueAsString=c,l.x2.baseVal.valueAsString=c,m.x1.baseVal.valueAsString=d,m.x2.baseVal.valueAsString=d,f["default"].addClass(l,"active"),f["default"].addClass(m,"active"),b.parentNode.appendChild(l),b.parentNode.appendChild(m)},o=function(a){f["default"].removeClass(a.target,"active"),f["default"].removeClass(l,"active"),f["default"].removeClass(m,"active")};return j.appendChild(g.createTimeWrapper(a.durationMs,h)),j.appendChild(g.renderMarks(a.marks,b,h)),a.lines.forEach(function(a,c){j.appendChild(g.createBgRect(a,b,h))}),c.forEach(function(a,c){var d=a.total||1,f=25*c,h={width:d,height:25,x:a.start||.001,y:f,cssClass:a.cssClass,label:a.name+" ("+a.start+"ms - "+a.end+"ms | total: "+a.total+"ms)",unit:b,onRectMouseEnter:n,onRectMouseLeave:o};j.appendChild(g.createRect(h,a.segments));var i=a.name.length>30&&a.name.indexOf("?")>0,l=i?a.name.split("?")[0]+"?....":a.name,m=e["default"].newTextEl(l+" ("+Math.round(a.total)+"ms)",f+(a.segments?20:17));m.appendChild(e["default"].newEl("title",{text:a.name})),(a.total||1)/b>10&&e["default"].getNodeTextWidth(m)<200?(m.setAttribute("class","inner-label"),m.setAttribute("x",(a.start||.001)/b+.5+"%"),m.setAttribute("width",d/b+"%")):(a.start||.001)/b+d/b<80?m.setAttribute("x",(a.start||.001)/b+d/b+.5+"%"):(m.setAttribute("x",(a.start||.001)/b-.5+"%"),m.setAttribute("text-anchor","end")),m.style.opacity=a.name.match(/js.map$/)?"0.5":"1",k.appendChild(m)}),j.appendChild(k),j}var e=a("./helpers/svg"),f=a("./helpers/dom"),g=a("./helpers/waterfall-componets");c.setupTimeLine=d},{"./helpers/dom":1,"./helpers/svg":2,"./helpers/waterfall-componets":3}]},{},[4]);